---
namespace: wordpress-mysql

db:
  metadata:
    private: true
  defines: runnable
  variables:
    image-tag:
      type: string
      value: latest
    rpc-port:
      type: int
      value: 3306
    database_name:
      type: string
      env: MYSQL_DATABASE
      value: wpdb
    database_user:
      env: MYSQL_USER
      type: string
      value: db_user
    mpassword:
      env: MYSQL_PASSWORD
      type: string
      value: RhgDPXPEnAgJ5q5g
    database_root_password:
      env: MYSQL_ROOT_PASSWORD
      value: RhgDPXPEnAgJ5q5g
      type: string
    wordpress_mysql_data:
      type: string
      value: wordpress-mysql
  containers:
    mysql:
      image-tag: <- `${image-tag}`
      image: mysql
  services:
    mysql-svc:
      container: mysql
      port: 3306
      protocol: tcp

wordpress:
  metadata:
    private: true
  defines: runnable
  connections:
    db:
      runnable: wordpress-mysql/db
      service: mysql-svc
  containers:
    wordpress:
      image: wordpress
  depends:
    wait-for:
      runnables:
        - wordpress-mysql/db
      timeout: 30
  variables:
    wordpress-db-user:
      type: string
      env: WORDPRESS_DB_USER
      value: db_user
    WORDPRESS_DB_PASSWORD:
      env: WORDPRESS_DB_PASSWORD
      type: string
      value: RhgDPXPEnAgJ5q5g
    wordpress-db-name:
      env: WORDPRESS_DB_NAME
      type: string
      value: wpdb
    wordpress-db-host:
      env: WORDPRESS_DB_HOST
      type: string
      value: <- connection-hostname("db") split(".dns.podman") join("")
    server-port:
      type: int
      value: 8088
  services:
    wordpress-svc:
      container: wordpress
      port: 8088
      protocol: tcp
      host-port: 8088
